!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.BondWeb=n():t.BondWeb=n()}(this,(function(){return(()=>{"use strict";var t={};return(()=>{var n=t;Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){var n=t.bondEnv,i=void 0===n?"api":n;this._appendPlaidLinkInitializeScript(),this.bondEnv=i,this.plaidEnv="api"===i||"api.staging"===i||"api.dev"===i?"production":"sandbox",this.bondHost="https://"+this.bondEnv+".bond.tech"}return t.prototype._appendPlaidLinkInitializeScript=function(){var t=document.createElement("script");t.src="https://cdn.plaid.com/link/v2/stable/link-initialize.js",document.body.appendChild(t)},t.prototype._initializePlaidLink=function(t,n,i,e,o){var c=this,a=o.update,d=void 0!==a&&a,u=o.linkedAccountId;return new Promise((function(o,a){try{var r=Plaid.create({env:c.plaidEnv,token:e.link_token,onSuccess:function(r,s){d?o({status:"micro_deposit",linked_account_id:u}):c._createAccessToken(t,n,i,r,s,e).then(o).catch(a)},onLoad:function(){r.open()},onExit:function(t,n){},onEvent:function(t,n){},receivedRedirectUri:null})}catch(t){a(t)}}))},t.prototype._createAccessToken=function(t,n,i,e,o,c){var a=this;return new Promise((function(d,u){var r=o.account.verification_status||"instantly_verified",s=o.account.id,p=c.linked_account_id,l=o.institution.name||"None";fetch(a.bondHost+"/api/v0/accounts/"+t+"/external_accounts/plaid",{method:"POST",headers:{Identity:n,Authorization:i,"Content-type":"application/json"},body:JSON.stringify({public_token:e,linked_account_id:p,external_account_id:s,status:r,bank_name:l})}).then((function(t){return t.json()})).then((function(t){t.Status?u(t):d({status:"successfully_linked",linked_account_id:p})})).catch(u)}))},t.prototype.linkAccount=function(t){var n=this,i=t.accountId,e=t.identity,o=t.authorization;return fetch(this.bondHost+"/api/v0/accounts/"+i+"/external_accounts/plaid",{method:"GET",headers:{Identity:e,Authorization:o,"Content-type":"application/json"}}).then((function(t){return t.json()})).then((function(t){return n._initializePlaidLink(i,e,o,t,{update:!1})}))},t.prototype._updateLinkToken=function(t){var n=this,i=t.accountId,e=t.linkedAccountId,o=t.identity,c=t.authorization;return new Promise((function(t,a){try{return fetch(n.bondHost+"/api/v0/accounts/"+i+"/external_accounts/plaid",{method:"PATCH",headers:{"Content-Type":"application/json",Identity:o,Authorization:c},body:JSON.stringify({linked_account_id:e})}).then((function(t){return t.json()})).then(t)}catch(t){a(t)}}))},t.prototype.microDeposit=function(t){var n=this,i=t.accountId,e=t.linkedAccountId,o=t.identity,c=t.authorization;return this._updateLinkToken({accountId:i,linkedAccountId:e,identity:o,authorization:c}).then((function(t){return n._initializePlaidLink(i,o,c,t,{update:!0,linkedAccountId:e})}))},t}();n.default=i})(),t})()}));